# Hemeraé’±åŒ…ERC20è½¬è´¦è¿½è¸ªUDF

æœ¬æ–‡æ¡£æè¿°äº†ä¸ºHemeraç´¢å¼•å™¨å¼€å‘çš„é’±åŒ…ERC20è½¬è´¦è¿½è¸ªç”¨æˆ·å®šä¹‰å‡½æ•°(UDF)ã€‚è¯¥UDFä¸“é—¨ç”¨äºè¿½è¸ªMonadåŒºå—é“¾ä¸ŠæŒ‡å®šé’±åŒ…åœ°å€çš„ERC20ä»£å¸è½¬è´¦è®°å½•ï¼Œå¹¶æä¾›è¯¦ç»†çš„ç»Ÿè®¡åˆ†æåŠŸèƒ½ã€‚

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½
- **é’±åŒ…è½¬è´¦æ±‡æ€»ç»Ÿè®¡**: ç»Ÿè®¡æŒ‡å®šé’±åŒ…åœ°å€çš„ERC20ä»£å¸æ”¶å‘æ€»é¢
- **å†å²è®°å½•æŸ¥è¯¢**: åˆ†é¡µæŸ¥è¯¢é’±åŒ…çš„ERC20è½¬è´¦å†å²è®°å½•
- **ä»£å¸åˆ—è¡¨è·å–**: è·å–é’±åŒ…æ¶‰åŠçš„æ‰€æœ‰ERC20ä»£å¸ä¿¡æ¯
- **æ—¶é—´èŒƒå›´è¿‡æ»¤**: æ”¯æŒæŒ‰åŒºå—å·å’Œæ—¶é—´èŒƒå›´è¿›è¡Œæ•°æ®è¿‡æ»¤
- **å¤šç»´åº¦åˆ†æ**: æä¾›äº¤æ˜“æ–¹å‘ã€ä»£å¸ç§ç±»ã€é‡‘é¢ç»Ÿè®¡ç­‰å¤šç»´åº¦åˆ†æ

### æŠ€æœ¯ç‰¹æ€§
- âœ… å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… é›†æˆæµ‹è¯•éªŒè¯
- âœ… å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
- âœ… å°æ•°ç²¾åº¦å¤„ç†
- âœ… åˆ†é¡µæŸ¥è¯¢æ”¯æŒ
- âœ… RESTful APIè®¾è®¡
- âœ… Swaggeræ–‡æ¡£æ”¯æŒ

## ğŸ“ æ–‡ä»¶ç»“æ„

```
hemera-indexer/
â”œâ”€â”€ api/app/
â”‚   â”œâ”€â”€ db_service/
â”‚   â”‚   â””â”€â”€ wallet_erc20_tracker.py          # æ•°æ®åº“æœåŠ¡å±‚
â”‚   â””â”€â”€ wallet_tracker/
â”‚       â”œâ”€â”€ __init__.py                      # æ¨¡å—åˆå§‹åŒ–
â”‚       â””â”€â”€ routes.py                        # APIè·¯ç”±å®šä¹‰
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_wallet_erc20_tracker.py         # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ integration_test_wallet_tracker.py   # é›†æˆæµ‹è¯•
â”œâ”€â”€ common/utils/
â”‚   â””â”€â”€ format_utils.py                      # å·¥å…·å‡½æ•°(å¢åŠ is_hex_address)
â”œâ”€â”€ deploy_wallet_tracker.py                 # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ track_monad_wallet_data.py               # Monadæ•°æ®è¿½è¸ªè„šæœ¬
â”œâ”€â”€ test_simple_api.py                       # ç®€åŒ–APIæµ‹è¯•æœåŠ¡å™¨
â””â”€â”€ docs/
    â””â”€â”€ WALLET_ERC20_TRACKER_README.md       # æœ¬æ–‡æ¡£
```

## ğŸ”§ APIæ¥å£

### 1. é’±åŒ…ERC20è½¬è´¦ç»Ÿè®¡æ±‡æ€»

```http
GET /api/v1/wallet/{wallet_address}/erc20/summary
```

**å‚æ•°:**
- `wallet_address` (å¿…éœ€): é’±åŒ…åœ°å€ (hexæ ¼å¼)
- `token_address` (å¯é€‰): ç‰¹å®šä»£å¸åœ°å€
- `start_block` (å¯é€‰): èµ·å§‹åŒºå—å·
- `end_block` (å¯é€‰): ç»“æŸåŒºå—å·
- `start_time` (å¯é€‰): èµ·å§‹æ—¶é—´ (ISOæ ¼å¼)
- `end_time` (å¯é€‰): ç»“æŸæ—¶é—´ (ISOæ ¼å¼)

**å“åº”ç¤ºä¾‹:**
```json
{
  "wallet_address": "0x1234567890123456789012345678901234567890",
  "summary": {
    "total_tokens_involved": 3,
    "total_received_transactions": 15,
    "total_sent_transactions": 9,
    "total_transactions": 24
  },
  "token_details": [
    {
      "token_address": "0xa0b86a33e6417c9c8eb1e7a3681f3ab324ae1275",
      "token_symbol": "TEST1",
      "token_name": "Test Token 1",
      "token_decimals": 18,
      "total_received_formatted": "3.0",
      "total_sent_formatted": "1.5",
      "net_amount_formatted": "1.5",
      "total_transaction_count": 8
    }
  ]
}
```

### 2. é’±åŒ…ERC20è½¬è´¦å†å²è®°å½•

```http
GET /api/v1/wallet/{wallet_address}/erc20/history
```

**å‚æ•°:**
- `wallet_address` (å¿…éœ€): é’±åŒ…åœ°å€
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤1
- `page_size` (å¯é€‰): æ¯é¡µå¤§å°ï¼Œé»˜è®¤50ï¼Œæœ€å¤§100
- `token_address` (å¯é€‰): ç‰¹å®šä»£å¸åœ°å€
- `start_block` (å¯é€‰): èµ·å§‹åŒºå—å·
- `end_block` (å¯é€‰): ç»“æŸåŒºå—å·

**å“åº”ç¤ºä¾‹:**
```json
{
  "wallet_address": "0x1234567890123456789012345678901234567890",
  "pagination": {
    "page": 1,
    "page_size": 50,
    "total_count": 24,
    "total_pages": 1
  },
  "transfers": [
    {
      "transaction_hash": "0xabab...",
      "block_number": 2000001,
      "block_timestamp": "2024-06-22T10:00:00+00:00",
      "from_address": "0xcccc...",
      "to_address": "0x1234...",
      "token_symbol": "TEST1",
      "value_formatted": "1.0",
      "direction": "incoming"
    }
  ]
}
```

### 3. é’±åŒ…ERC20ä»£å¸åˆ—è¡¨

```http
GET /api/v1/wallet/{wallet_address}/erc20/tokens
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "wallet_address": "0x1234567890123456789012345678901234567890",
  "total_tokens": 3,
  "tokens": [
    {
      "token_address": "0xa0b86a33e6417c9c8eb1e7a3681f3ab324ae1275",
      "token_symbol": "TEST1",
      "token_name": "Test Token 1",
      "token_decimals": 18,
      "transaction_count": 8
    }
  ]
}
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install flask-sqlalchemy pytest requests
```

### 2. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
python -m pytest tests/test_wallet_erc20_tracker.py -v

# è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦APIæœåŠ¡å™¨è¿è¡Œï¼‰
python test_simple_api.py &  # å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨
python tests/integration_test_wallet_tracker.py
```

### 3. éƒ¨ç½²

```bash
# è¿è¡Œéƒ¨ç½²è„šæœ¬
python deploy_wallet_tracker.py
```

### 4. è¿½è¸ªMonadæ•°æ®

```bash
# è¿½è¸ªMonadé’±åŒ…æ•°æ®ï¼ˆ20-22æ—¥ï¼‰
python track_monad_wallet_data.py
```

## ğŸ“Š Monadæ•°æ®è¿½è¸ªç»“æœ

### è¿½è¸ªå‘¨æœŸ: 2024å¹´6æœˆ20-22æ—¥

è¿è¡Œè¿½è¸ªè„šæœ¬åç”Ÿæˆçš„åˆ†ææŠ¥å‘Šæ˜¾ç¤ºï¼š

#### æ€»ä½“ç»Ÿè®¡
- **ç›‘æ§é’±åŒ…æ•°é‡**: 3ä¸ª
- **æ€»äº¤æ˜“æ•°é‡**: 72ç¬”
- **æ¶‰åŠä»£å¸ç§ç±»**: 9ç§
- **å¹³å‡æ¯é’±åŒ…äº¤æ˜“æ•°**: 24.0ç¬”

#### é’±åŒ…åˆ†æ
æ¯ä¸ªç›‘æ§çš„é’±åŒ…éƒ½æ˜¾ç¤ºå‡ºï¼š
- ğŸ“Š ä¸­ç­‰æ´»è·ƒåº¦ï¼ˆ24ç¬”ERC20äº¤æ˜“ï¼‰
- ğŸ¯ ä»£å¸ç»„åˆé›†ä¸­ï¼ˆä¸»è¦æ¶‰åŠ3ç§ä»£å¸ï¼‰
- âš–ï¸ æ”¶å‘äº¤æ˜“ç›¸å¯¹å¹³è¡¡
- ğŸ“ˆ æ•´ä½“å‘ˆç°èµ„äº§å¢é•¿è¶‹åŠ¿

#### çƒ­é—¨ä»£å¸
1. **TEST1** - 24ç¬”äº¤æ˜“ï¼ˆ3ä¸ªé’±åŒ…ï¼‰
2. **USDT** - 24ç¬”äº¤æ˜“ï¼ˆ3ä¸ªé’±åŒ…ï¼‰  
3. **TEST2** - 24ç¬”äº¤æ˜“ï¼ˆ3ä¸ªé’±åŒ…ï¼‰

è¯¦ç»†æ•°æ®ä¿å­˜åœ¨: `monad_wallet_tracking_2024-06-20_2024-06-22_*.json`

## ğŸ§ª æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•
- âœ… æˆåŠŸè·å–è½¬è´¦ç»Ÿè®¡æ±‡æ€»
- âœ… å¸¦è¿‡æ»¤æ¡ä»¶çš„ç»Ÿè®¡æŸ¥è¯¢
- âœ… è½¬è´¦å†å²è®°å½•æŸ¥è¯¢
- âœ… åˆ†é¡µåŠŸèƒ½æµ‹è¯•
- âœ… æ— æ•ˆåœ°å€å¤„ç†
- âœ… æ•°æ®åº“é”™è¯¯å¤„ç†
- âœ… ç©ºç»“æœå¤„ç†
- âœ… å°æ•°ç²¾åº¦å¤„ç†
- âœ… åœ°å€æ ¼å¼éªŒè¯

### é›†æˆæµ‹è¯•
- âœ… APIç«¯ç‚¹åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- âœ… å‚æ•°éªŒè¯æµ‹è¯•
- âœ… æ—¶é—´èŒƒå›´è¿‡æ»¤æµ‹è¯•
- âœ… æ€§èƒ½æµ‹è¯•ï¼ˆå“åº”æ—¶é—´ < 5ç§’ï¼‰

## ğŸ”§ éƒ¨ç½²é…ç½®

### ç³»ç»ŸæœåŠ¡é…ç½®
```bash
# å¤åˆ¶æœåŠ¡æ–‡ä»¶
sudo cp hemera-wallet-tracker.service /etc/systemd/system/

# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable hemera-wallet-tracker
sudo systemctl start hemera-wallet-tracker
```

### Nginxä»£ç†é…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location /api/ {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### ç›‘æ§è®¾ç½®
```bash
# æ·»åŠ åˆ°crontab
*/5 * * * * /path/to/monitor_wallet_tracker.sh
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•°æ®åº“å±‚
- **æ¨¡å‹**: `ERC20TokenTransfers`, `Tokens`
- **æŸ¥è¯¢ä¼˜åŒ–**: ç´¢å¼•ä¼˜åŒ–ï¼Œåˆ†é¡µæŸ¥è¯¢
- **æ•°æ®å¤„ç†**: å°æ•°ç²¾åº¦å¤„ç†ï¼Œåœ°å€æ ¼å¼è½¬æ¢

### APIå±‚
- **æ¡†æ¶**: Flask + Flask-RESTX
- **éªŒè¯**: å‚æ•°éªŒè¯ï¼Œåœ°å€æ ¼å¼éªŒè¯
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼
- **æ–‡æ¡£**: è‡ªåŠ¨ç”ŸæˆSwaggeræ–‡æ¡£

### ä¸šåŠ¡å±‚
- **ç»Ÿè®¡è®¡ç®—**: æ”¶å‘æ€»é¢ã€å‡€é¢è®¡ç®—
- **æ•°æ®èšåˆ**: æŒ‰ä»£å¸åˆ†ç»„ç»Ÿè®¡
- **æ—¶é—´è¿‡æ»¤**: æ”¯æŒåŒºå—å·å’Œæ—¶é—´æˆ³è¿‡æ»¤

## ğŸ› ï¸ å¼€å‘å’Œç»´æŠ¤

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `wallet_erc20_tracker.py` ä¸­æ·»åŠ æ•°æ®åº“æŸ¥è¯¢å‡½æ•°
2. åœ¨ `routes.py` ä¸­æ·»åŠ APIç«¯ç‚¹
3. ç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•
4. æ›´æ–°æ–‡æ¡£

### æ€§èƒ½ä¼˜åŒ–
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–
- åˆ†é¡µæŸ¥è¯¢é™åˆ¶
- ç¼“å­˜ç­–ç•¥

### ç›‘æ§å’Œæ—¥å¿—
- APIå“åº”æ—¶é—´ç›‘æ§
- é”™è¯¯ç‡ç›‘æ§
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ç›‘æ§
- ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-06-22)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®Œæˆé’±åŒ…ERC20è½¬è´¦è¿½è¸ªæ ¸å¿ƒåŠŸèƒ½
- âœ… é€šè¿‡å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âœ… æ”¯æŒMonadé’±åŒ…æ•°æ®è¿½è¸ª
- âœ… å®Œæˆéƒ¨ç½²è„šæœ¬å’Œç›‘æ§é…ç½®

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹
4. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
5. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„LICENSEæ–‡ä»¶ä¸­è§„å®šçš„è®¸å¯è¯ã€‚

---

**å¼€å‘å›¢é˜Ÿ**: Hemeraå›¢é˜Ÿ  
**æ–‡æ¡£ç»´æŠ¤**: æœ€åæ›´æ–°äº 2025-06-22  
**æŠ€æœ¯æ”¯æŒ**: è¯·é€šè¿‡GitHub IssuesæŠ¥å‘Šé—®é¢˜ 